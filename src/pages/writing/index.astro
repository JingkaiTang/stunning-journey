---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { pickCover, resolveMaybeRelativeUrl } from '../../utils/contentPreview';

const posts = (await getCollection('writing'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout title="Writing | 唐靖凯" description="AI 相关文章与实践记录">
  <section class="section glass">
    <div class="section-head">
      <h2>Writing</h2>
      <p>AI 相关文章与实践记录（按时间倒序）。</p>
    </div>

    <div style="display:grid; gap:16px;">
      {posts.map((post) => {
        const href = `/writing/${post.slug.replace(/\/index$/, '')}/`;
        const coverRaw = pickCover(post);
        const cover = coverRaw ? resolveMaybeRelativeUrl(coverRaw, href) : null;
        return (
          <article class="project-card" style="transform:none;">
            <div style={`display:grid; ${cover ? 'grid-template-columns: 140px 1fr; gap: 14px; align-items: start;' : ''}`}>
              {cover ? (
                <a href={href} style="display:block;">
                  <img
                    src={cover}
                    alt={post.data.title}
                    loading="lazy"
                    style="width: 140px; height: 92px; object-fit: cover; border-radius: 12px; border: 1px solid var(--border);"
                  />
                </a>
              ) : null}

              <div>
                <h3 style="margin:0 0 6px;">
                  <a href={`/writing/${post.slug.replace(/\/index$/, '')}/`} style="color: var(--text); text-decoration:none;">
                    {post.data.title}
                  </a>
                </h3>
                {post.data.description ? <p style="margin: 0 0 10px; color: var(--muted);">{post.data.description}</p> : null}
                <span>
                  {post.data.pubDate.toISOString().slice(0, 10)}
                  {post.data.tags.length ? (
                    <> · {post.data.tags.map((t, i) => (
                      <>
                        <a href={`/tags/${encodeURIComponent(t)}/`} style="color: var(--muted); text-decoration:none;">{t}</a>
                        {i < post.data.tags.length - 1 ? ' / ' : ''}
                      </>
                    ))}</>
                  ) : null}
                </span>
              </div>
            </div>
          </article>
        );
      })}

      {posts.length === 0 ? <p style="color: var(--muted);">还没有文章。</p> : null}
    </div>
  </section>
</BaseLayout>
