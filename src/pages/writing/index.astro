---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import PostCard from '../../components/PostCard.astro';
import { pickCover, resolveMaybeRelativeUrl } from '../../utils/contentPreview';
import { formatShanghai } from '../../utils/dateFormat';

const posts = (await getCollection('writing'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<BaseLayout title="Writing | 唐靖凯" description="AI 相关文章与实践记录">
  <section class="section glass">
    <div class="section-head">
      <h2>Writing</h2>
    </div>

    <div style="display:grid; gap:16px;">
      {posts.map((post) => {
        const href = `/writing/${post.slug.replace(/\/index$/, '')}/`;
        const coverRaw = pickCover(post);
        const cover = coverRaw ? resolveMaybeRelativeUrl(coverRaw, href) : null;
        return (
          <PostCard href={href} title={post.data.title} description={post.data.description} cover={cover} kindLabel="Writing">
            <Fragment slot="meta">
              <span style="color: var(--muted);">
                {formatShanghai(post.data.pubDate, { withSeconds: true })}
                {post.data.tags.length ? (
                  <> · {post.data.tags.map((t, i) => (
                    <>
                      <a href={`/tags/${encodeURIComponent(t)}/`} style="color: var(--muted); text-decoration:none;">{t}</a>
                      {i < post.data.tags.length - 1 ? ' / ' : ''}
                    </>
                  ))}</>
                ) : null}
              </span>
            </Fragment>
          </PostCard>
        );
      })}

      {posts.length === 0 ? <p style="color: var(--muted);">还没有文章。</p> : null}
    </div>
  </section>
</BaseLayout>
