---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const writingPosts = (await getCollection('writing')).filter((p) => !p.data.draft);
const nowPosts = (await getCollection('now')).filter((p) => !p.data.draft);

const posts = [...writingPosts, ...nowPosts];

const tagCounts = new Map<string, number>();
for (const p of posts) {
  for (const t of p.data.tags ?? []) {
    tagCounts.set(t, (tagCounts.get(t) ?? 0) + 1);
  }
}

const tags = [...tagCounts.entries()].sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0]));
---

<BaseLayout title="Tags | 唐靖凯" description="标签（Writing + Now）">
  <section class="section glass" style="max-width: 900px;">
    <div class="section-head">
      <h2>Tags</h2>
      <p>按标签浏览 Writing / Now。</p>
    </div>

    <div class="tag-index-grid" style="margin-top: 16px;">
      {tags.map(([tag, count]) => (
        <a class="project-card tag-index-card" href={`/tags/${encodeURIComponent(tag)}/`}>
          <span class="tag-index-card__name">#{tag}</span>
          <span class="tag-index-card__count">{count}</span>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>
